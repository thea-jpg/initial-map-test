<!DOCTYPE html>
<html>
<head>

	<title>UFNP Initial Test</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="UNFP Map tests">
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

<script src="https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css" rel="stylesheet" />
<link href="simple-grid.css" rel="stylesheet" >
</head>
<body>
	<div class="container">
		<main>
		<div class="row">
			<div class="col-3">
			</div>
			<div class="col-6">

				<!-- TK draws the map-->
				<div id="map"><nav id="filter-group" class="filter-group"></nav></div>

			</div>
			<div class="col-3">
			</div>
		</div>
	</main>
</div>




<script>
 mapboxgl.accessToken = "pk.eyJ1IjoidWZubWFwdGVzdCIsImEiOiJja2FybjQ0b2kwbzNoMnhwbG1oNnBwbzh6In0.IEdNzx7pvq0qiHAIZQckJw";
 // TK filtering by tag below is majority from https://docs.mapbox.com/mapbox-gl-js/example/filter-markers/
 // TK ideally be able to pull this from the data is the map style being referenced, so as to make uploading changing data easier
     var places = {
         'type': 'FeatureCollection',
 // TK geojson created w/in the dataset studio of mapbox, using placeholder values for the moment, exported as geojson file
 // TK	   variable 'tags' replaced by 'icons' for the moment, will be returned soon
       "features": [
    {
      "type": "Feature",
      "properties": {
        "tags": "funny",
        "name": "Oar-Some Osprey",
        "location": "Opera Bar",
        "excerpt": "Lorem Ipsum",
        "storyFullText": "Lorem Ipsum",
        "coverImage": "Lorem Ipsum",
        "url": "https://urbanfieldnaturalist.org/stories/oar-some-osprey",
        "date": "01-01-2020",
        "storyAuthor": "Lorem Ipsum",
        "authorBio": "Lorem Ipsum"
      },
      "geometry": {
        "coordinates": [
          151.213852,
          -33.858318
        ],
        "type": "Point"
      },
      "id": "0564d9a1918093e567afb4fb7856745d"
    },
    {
      "type": "Feature",
      "properties": {
        "storyAuthor": "Lorem Ipsum",
        "excerpt": "Lorem Ipsum",
        "coverImage": "Lorem Ipsum",
        "name": "Sometimes Nature Comes to You",
        "date": "01-01-2020",
        "url": "https://urbanfieldnaturalist.org/stories/sometimes-nature-comes-to-you",
        "storyFullText": "Lorem Ipsum",
        "location": "Ivanhoe, Victoria, Australia",
        "tags": "curious",
        "wikidata": "Q3156237",
        "authorBio": "Lorem Ipsum"
      },
      "geometry": {
        "coordinates": [
          145.0457,
          -37.7703
        ],
        "type": "Point"
      },
      "id": "locality.14898022940438750"
    },
    {
      "type": "Feature",
      "properties": {
        "storyAuthor": "Lorem Ipsum",
        "excerpt": "Lorem Ipsum",
        "coverImage": "Lorem Ipsum",
        "name": "From Telephoto to Macro, the Big Side of a Small World",
        "date": "01-01-2020",
        "url": "https://urbanfieldnaturalist.org/stories/telephoto-to-macro",
        "storyFullText": "Lorem Ipsum",
        "location": "Cammeray, New South Wales, Australia",
        "tags": "funny",
        "wikidata": "Q5026863",
        "authorBio": "Lorem Ipsum"
      },
      "geometry": {
        "coordinates": [
          151.22,
          -33.8231
        ],
        "type": "Point"
      },
      "id": "locality.1832825270203500"
    },
    {
      "type": "Feature",
      "properties": {
        "storyAuthor": "Lorem Ipsum",
        "excerpt": "Lorem Ipsum",
        "coverImage": "Lorem Ipsum",
        "name": "Not Really Friends",
        "date": "01-01-2020",
        "url": "https://urbanfieldnaturalist.org/stories/not-really-friends",
        "storyFullText": "Lorem Ipsum",
        "location": "Fitzroy, Victoria, Australia",
        "tags": "funny",
        "wikidata": "Q1421389",
        "authorBio": "Lorem Ipsum"
      },
      "geometry": {
        "coordinates": [
          144.979,
          -37.8011
        ],
        "type": "Point"
      },
      "id": "locality.3311283460220480"
    },
    {
      "type": "Feature",
      "properties": {
        "storyAuthor": "Lorem Ipsum",
        "excerpt": "Lorem Ipsum",
        "coverImage": "Lorem Ipsum",
        "name": "Welcoming a Change",
        "date": "01-01-2020",
        "url": "https://urbanfieldnaturalist.org/stories/welcoming-a-change",
        "storyFullText": "Lorem Ipsum",
        "location": "Rozelle, New South Wales, Australia",
        "tags": "joyful",
        "wikidata": "Q6270986",
        "authorBio": "Lorem Ipsum"
      },
      "geometry": {
        "coordinates": [
          151.167,
          -33.8649
        ],
        "type": "Point"
      },
      "id": "locality.5966651846933350"
    },
    {
      "type": "Feature",
      "properties": {
        "storyAuthor": "Lorem Ipsum",
        "excerpt": "Lorem Ipsum",
        "coverImage": "Lorem Ipsum",
        "name": "A Stunning Aussie Bee",
        "date": "01-01-2020",
        "url": "https://urbanfieldnaturalist.org/stories/a-stunning-aussie-bee",
        "storyFullText": "Lorem Ipsum",
        "location": "Drummoyne, New South Wales, Australia",
        "tags": "curious",
        "wikidata": "Q5309255",
        "authorBio": "Lorem Ipsum"
      },
      "geometry": {
        "coordinates": [
          151.154,
          -33.8535
        ],
        "type": "Point"
      },
      "id": "locality.8869668159147530"
    },
    {
      "type": "Feature",
      "properties": {
        "storyAuthor": "Lorem Ipsum",
        "excerpt": "Lorem Ipsum",
        "coverImage": "Lorem Ipsum",
        "name": "Scrumptious Scats, Seriously",
        "date": "01-01-2020",
        "url": "https://urbanfieldnaturalist.org/stories/scrumptious-scats",
        "storyFullText": "Lorem Ipsum",
        "location": "Blue Mountains, New South Wales, Australia",
        "tags": "curious",
        "wikidata": "Q667529",
        "authorBio": "Lorem Ipsum"
      },
      "geometry": {
        "coordinates": [
          150.38,
          -33.71
        ],
        "type": "Point"
      },
      "id": "place.2697685586399870"
    }
  ]
    };


// TK variables above for filtergroup
    var filterGroup = document.getElementById('filter-group');

// TK draws map in #map
  var map = new mapboxgl.Map({
    container: "map",
		// TK this loaded style includes the dataset for filtering and location, and the map tile styling
    style: "mapbox://styles/ufnmaptest/ckb0e5f8q0o3e1il9tpcbvbp0",
// TK set location for start of this story, point to From Telephoto to Macro location
		center: [151.22,
			-33.8231],
		zoom:12
  });

	//TK add fullscreen controls from https://docs.mapbox.com/mapbox-gl-js/example/fullscreen/
	// TK ideally would be able to control this to be large but not fullscreen, need to break column/margin assigned to col-6
	map.addControl(new mapboxgl.FullscreenControl());
	// TK add navigation control
	var nav = new mapboxgl.NavigationControl();
	map.addControl(nav);

// TK actual filtering of variables begins here
    map.on('load', function() {
        // Add a GeoJSON source containing place coordinates and information.
        map.addSource('places', {
            'type': 'geojson',
            'data': places
        });

        places.features.forEach(function(feature) {
            var symbol = feature.properties['tags'];
            var layerID = 'poi-' + symbol;

            // Add a layer for this symbol type if it hasn't been added already.
            if (!map.getLayer(layerID)) {
                map.addLayer({
                    'id': layerID,
                    'type': 'symbol',
                    'source': 'places',
                    'layout': {
                        'icon-image': 'dot-11',
                        'icon-size':6,
                        'icon-allow-overlap': true
                    },
                    'filter': ['==', 'tags', symbol]
                });

								// TK following three instructions with map.on are from https://docs.mapbox.com/mapbox-gl-js/example/center-on-symbol/
								// TK use to focus and change zoom
								// Center the map on the coordinates of any clicked symbol from the 'symbols' layer.
								map.on('click', layerID, function(e) {
								map.flyTo({ center: e.features[0].geometry.coordinates });
								});

								// Change the cursor to a pointer when the it enters a feature in the 'symbols' layer.
								map.on('mouseenter', layerID, function() {
								map.getCanvas().style.cursor = 'pointer';
								});

								// Change it back to a pointer when it leaves.
								map.on('mouseleave', layerID, function() {
								map.getCanvas().style.cursor = '';
								});


                // Add checkbox and label elements for the layer.
                var input = document.createElement('input');
                input.type = 'checkbox';
                input.id = layerID;
                input.checked = true;
                filterGroup.appendChild(input);

                var label = document.createElement('label');
                label.setAttribute('for', layerID);
                label.textContent = symbol;
                filterGroup.appendChild(label);

                // When the checkbox changes, update the visibility of the layer.
                input.addEventListener('change', function(e) {
                    map.setLayoutProperty(
                        layerID,
                        'visibility',
                        e.target.checked ? 'visible' : 'none'
                    );
                });
            }
        });
    });

// TK using code from https://docs.mapbox.com/help/tutorials/add-points-pt-3/ placeholder JSON I created
			map.on('click', function(e) {
				// TK var pops identifies the marker pointed to
var pops = map.queryRenderedFeatures(e.point, {
	data:'places' // TK dataset layer name
});

if (!pops.length) {
	return;
}

var pops = pops[0];

// TK offset popup so it doesn't cover the marker

var popup = new mapboxgl.Popup({ offset: [0, -20] })
	 .setLngLat(pops.geometry.coordinates)
	 // TK currently displays name of article and link to full article
	 .setHTML('<h5>' + pops.properties.name + '</h5><p><a href="' + pops.properties.url + '">read the full story</a></p>')
	 .addTo(map);
});
</script>

</body>
</html>
